<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coast Fi Calculator</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    max-width: 420px;
    margin: 0 auto;
    padding: 16px;
    background: #fafafa;
}
h1 { text-align:center; }

.section {
    background:white;
    padding:16px;
    margin-bottom:20px;
    border-radius:14px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
}

.locked { color:#b00000; }
.flex { color:#0b6b0b; }

label {
    margin-top:12px;
    display:block;
    font-weight:600;
}

.input-row {
    display:flex;
    align-items:center;
    gap:8px;
    margin-top:6px;
}

input {
    flex:1;
    padding:12px;
    font-size:1rem;
    border-radius:10px;
    border:1px solid #ccc;
    -moz-appearance:textfield;
}
input::-webkit-inner-spin-button,
input::-webkit-outer-spin-button {
    -webkit-appearance:none;
}

.info {
    min-width:36px;
    height:36px;
    border-radius:50%;
    background:#e0e0e0;
    text-align:center;
    font-weight:bold;
    line-height:36px;
    cursor:pointer;
    user-select:none;
}

button {
    height:52px;
    border:none;
    border-radius:12px;
    font-size:1rem;
    cursor:pointer;
}
button:active { transform:scale(0.98); }

.presets, .buttons {
    display:flex;
    gap:12px;
    margin-top:14px;
}
.presets button, .buttons button { flex:1; }

.btn-calc { background:#2e7d32; color:white; }
.btn-reset { background:#c62828; color:white; }
.btn-conservative { background:#c8e6c9; }
.btn-normal { background:#bbdefb; }
.btn-optimistic { background:#ffcdd2; }

.result {
    display:none;
    background:white;
    padding:16px;
    border-radius:14px;
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
}

.ok { color:#2e7d32; font-weight:bold; }
.warn { color:#b00000; font-weight:bold; }
.small { margin-top:10px; font-size:0.9rem; color:#444; }
hr { border:none; border-top:1px solid #ddd; margin:12px 0; }

/* Info popup */
.info-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}
.info-popup {
    background: white;
    border-radius: 16px;
    padding: 20px;
    max-width: 320px;
    width: 90%;
}
.info-popup button {
    margin-top: 16px;
    width: 100%;
    height: 44px;
    border-radius: 10px;
    background: #2e7d32;
    color: white;
}
</style>
</head>

<body>

<h1>Coast Fi Calculator</h1>

<div class="section">
<label>Nåværende alder</label>
<div class="input-row">
<input id="currentAge" inputmode="numeric">
<span class="info" onclick="showInfo('Alderen du er i dag i hele år.','Nåværende alder')">i</span>
</div>

<label>Alder du vil sjekke</label>
<div class="input-row">
<input id="targetAge" inputmode="numeric" value="62">
<span class="info" onclick="showInfo('Alderen du vil vurdere COAST FI-status for.','Målalder')">i</span>
</div>
</div>

<div class="section locked">
<h3>Låst kapital (62+)</h3>

<label>IPS – saldo i dag</label>
<div class="input-row">
<input id="ipsBalance" inputmode="numeric">
<span class="info" onclick="showInfo('Total verdi på IPS i dag.','IPS')">i</span>
</div>

<label>Årlig NAV-pensjon (etter skatt)</label>
<div class="input-row">
<input id="navPension" inputmode="numeric">
<span class="info" onclick="showInfo('Årlig NAV-pensjon etter skatt. Kan stå tomt.','NAV')">i</span>
</div>
</div>

<div class="section flex">
<h3>Fleksibel kapital</h3>

<label>Fond og aksjer</label>
<div class="input-row">
<input id="freeCapital" inputmode="numeric">
<span class="info" onclick="showInfo('Fond, ASK og enkeltaksjer i dag.','Fond')">i</span>
</div>

<label>Langsiktig bankinnskudd</label>
<div class="input-row">
<input id="bankSavings" inputmode="numeric">
<span class="info" onclick="showInfo('Bankinnskudd ment for langsiktig bruk.','Bank')">i</span>
</div>
</div>

<div class="section">
<label>Ønsket årlig forbruk (etter skatt)</label>
<div class="input-row">
<input id="annualSpendingNet" inputmode="numeric" value="400000">
<span class="info" onclick="showInfo('Årlig forbruk i dagens kroner, etter skatt.','Forbruk')">i</span>
</div>

<label>Forventet realavkastning (%)</label>
<div class="input-row">
<input id="returnRate" inputmode="numeric" value="5">
<span class="info" onclick="showInfo('Avkastning etter inflasjon.','Avkastning')">i</span>
</div>

<div class="presets">
<button class="btn-conservative" onclick="setReturn(3)">Konservativ</button>
<button class="btn-normal" onclick="setReturn(5)">Normal</button>
<button class="btn-optimistic" onclick="setReturn(7)">Optimistisk</button>
</div>

<label>Uttaksrate (%)</label>
<div class="input-row">
<input id="withdrawRate" inputmode="numeric" value="4">
<span class="info" onclick="showInfo('Hvor stor andel av kapitalen du tar ut årlig.','Uttaksrate')">i</span>
</div>
</div>

<div class="buttons">
<button class="btn-calc" onclick="calculate()">Beregn</button>
<button class="btn-reset" onclick="resetForm()">Nullstill</button>
</div>

<div class="result" id="result"></div>

<div class="info-overlay" id="infoOverlay" onclick="closeInfo()">
  <div class="info-popup" onclick="event.stopPropagation()">
    <h3 id="infoTitle"></h3>
    <p id="infoText"></p>
    <button onclick="closeInfo()">Lukk</button>
  </div>
</div>

<script>
/* ---------- Service Worker ---------- */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}

/* ---------- Info ---------- */
function showInfo(text,title){
 document.getElementById("infoTitle").innerText=title;
 document.getElementById("infoText").innerText=text;
 document.getElementById("infoOverlay").style.display="flex";
}
function closeInfo(){
 document.getElementById("infoOverlay").style.display="none";
}

/* ---------- Utils ---------- */
function num(id){
 const v=document.getElementById(id).value;
 return v===""?0:Number(v);
}
function saveInputs(){
 document.querySelectorAll("input").forEach(i=>{
   localStorage.setItem(i.id,i.value);
 });
}
function loadInputs(){
 document.querySelectorAll("input").forEach(i=>{
   if(localStorage.getItem(i.id)!==null){
     i.value=localStorage.getItem(i.id);
   }
 });
}

/* ---------- Presets ---------- */
function setReturn(v){
 document.getElementById("returnRate").value=v;
}

/* ---------- Core ---------- */
function calculate(){
 saveInputs();

 const age=num("currentAge"), target=num("targetAge");
 if(!age||target<=age){ alert("Sjekk alder."); return; }

 const years=target-age;
 const start=num("ipsBalance")+num("freeCapital")+num("bankSavings");
 const nav=num("navPension");
 const spend=Math.max(num("annualSpendingNet")-nav,0);
 const r=num("returnRate")/100;
 const w=num("withdrawRate")/100;

 const need=spend/w;
 const future=start*Math.pow(1+r,years);
 const diff=future-need;

 let yearsToCoast=null;
 for(let i=0;i<=80;i++){
   if(start*Math.pow(1+r,i)>=need){ yearsToCoast=i; break; }
 }

 let explanation="";
 if(diff>=0){
   explanation = yearsToCoast===0
   ? `Du er allerede COAST FI i dag. Kapitalen du har nå er tilstrekkelig til å dekke ønsket forbruk uten videre sparing.`
   : `Du når COAST FI om ca. ${yearsToCoast} år, rundt ${age+yearsToCoast} års alder.`;
 } else {
   explanation = `Du mangler ca. ${Math.round(-diff).toLocaleString()} kr ved valgt alder.
   Dette tilsvarer omtrent ${Math.round((-diff)/Math.pow(1+r,years)).toLocaleString()} kr investert i dag.`;
 }

 const html =
 `<strong>Status:</strong>
 <span class="${diff>=0?"ok":"warn"}">${diff>=0?"COAST FI":"Ikke COAST FI"}</span>
 <hr>
 Total kapital ved ${target}: <strong>${Math.round(future).toLocaleString()} kr</strong><br>
 Kapitalbehov: <strong>${Math.round(need).toLocaleString()} kr</strong>
 <div class="small">${explanation}</div>`;

 const res=document.getElementById("result");
 res.innerHTML=html;
 res.style.display="block";

 localStorage.setItem("resultHTML",html);
}

/* ---------- Reset ---------- */
function resetForm(){
 localStorage.clear();
 location.reload();
}

/* ---------- Restore ---------- */
window.onload=function(){
 loadInputs();
 const saved=localStorage.getItem("resultHTML");
 if(saved){
   const r=document.getElementById("result");
   r.innerHTML=saved;
   r.style.display="block";
 }
};
</script>

</body>
</html>
